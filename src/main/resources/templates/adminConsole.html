<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>GamerGaze</title>
<th:block th:include="~{fragments/template:: head}"></th:block>
</head>
<body>
    <div th:replace="~{fragments/template :: sidebar}"></div>
    <nav th:replace="~{fragments/template  :: nav}">Navbar</nav>
    <div class="main-content">
    	<div class="adminConsole">
	    	<div class="post">
	        	<h2>Admin Console</h2>
	        </div>
	        <!-- Users Table -->
	    	<div class="post">
	        	<h3>Users</h3>
	        </div>
	        <table class="table post">
	            <thead>
	                <tr>
	                    <th>ID</th>
	                    <th>Username</th>
	                    <th>Email</th>
	                    <th>Actions</th>
	                </tr>
	            </thead>
	            <tbody>
	                <tr th:each="user : ${users}">
	                    <td th:text="${user.id}">1</td>
	                    <td th:text="${user.username}">Username</td>
	                    <td th:text="${user.email}">user@example.com</td>
	                    <td>
	                        <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteUserModal" th:data-id="${user.id}" th:data-name="${user.username}">Delete</button>
	                    </td>
	                </tr>
	            </tbody>
	        </table>
	
	        <!-- Publications Table -->
	       	<div class="post">
	        	<h3>Publications</h3>
	        </div>
	        <table class="table post">
	            <thead>
	                <tr>
	                    <th>ID</th>
	                    <th>Content</th>
	                    <th>Author</th>
	                    <th>Actions</th>
	                </tr>
	            </thead>
	            <tbody>
	                <tr th:each="publication : ${publications}">
	                    <td th:text="${publication.id}">1</td>
	                    <td th:text="${publication.textContent}">Content</td>
	                    <td th:text="${publication.user.username}">Author</td>
	                    <td>
	                        <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deletePublicationModal" th:data-id="${publication.id}" th:data-content="${publication.textContent}">Delete</button>
	                    </td>
	                </tr>
	            </tbody>
	        </table>
		</div>
        <!-- Delete User Modal -->
        <div class="modal fade" id="deleteUserModal" tabindex="-1" aria-labelledby="deleteUserModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteUserModalLabel">Confirm Delete User</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Are you sure you want to delete user <span id="deleteUserName"></span>?
                    </div>
                    <div class="modal-footer">
                        <form th:action="@{/deleteUser}" method="post">
                            <input type="hidden" name="userId" id="deleteUserId">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-danger">Delete</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Publication Modal -->
        <div class="modal fade" id="deletePublicationModal" tabindex="-1" aria-labelledby="deletePublicationModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deletePublicationModalLabel">Confirm Delete Publication</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Are you sure you want to delete publication: <span id="deletePublicationContent"></span>?
                    </div>
                    <div class="modal-footer">
                        <form th:action="@{/deletePublication}" method="post">
                            <input type="hidden" name="publicationId" id="deletePublicationId">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-danger">Delete</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Pass user data to modal
        var deleteUserModal = document.getElementById('deleteUserModal');
        deleteUserModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            var userId = button.getAttribute('data-id');
            var userName = button.getAttribute('data-name');
            
            var modalUserId = deleteUserModal.querySelector('#deleteUserId');
            var modalUserName = deleteUserModal.querySelector('#deleteUserName');
            
            modalUserId.value = userId;
            modalUserName.textContent = userName;
        });

        // Pass publication data to modal
        var deletePublicationModal = document.getElementById('deletePublicationModal');
        deletePublicationModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            var publicationId = button.getAttribute('data-id');
            var publicationContent = button.getAttribute('data-content');
            
            var modalPublicationId = deletePublicationModal.querySelector('#deletePublicationId');
            var modalPublicationContent = deletePublicationModal.querySelector('#deletePublicationContent');
            
            modalPublicationId.value = publicationId;
            modalPublicationContent.textContent = publicationContent;
        });
    </script>
</body>
</html>
